<!DOCTYPE html>
<html>
<head>
  <title>Custom Playing Card Deck Generator</title>
  <style>
    body { font-family: sans-serif; text-align: center; background: #f9f9f9; }
    img.card { margin: 5px; border: 1px solid #aaa; border-radius: 8px; background: white; }
    #deck { display: flex; flex-wrap: wrap; justify-content: center; }
    input[type=file], select { margin-bottom: 5px; }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600&display=swap" rel="stylesheet">
</head>
<body>
  <h2>Custom Playing Card Generator</h2>

  <p>Upload your suit icons (PNG/SVG):</p>
  <input type="file" id="spadeUpload"> ♠ Spade<br>
  <input type="file" id="heartUpload"> ♥ Heart<br>
  <input type="file" id="clubUpload"> ♣ Club<br>
  <input type="file" id="diamondUpload"> ♦ Diamond<br><br>

  <p>Upload custom images for face/ace cards:</p>
  <p>File name format: suit_rank.png (e.g., spade_K.png, heart_Q.png)</p>
  <input type="file" id="faceUpload" multiple><br><br>

  <p>Upload a background image (optional):</p>
  <input type="file" id="bgUpload"><br><br>

  <p>Select font for the card:</p>
  <select id="fontSelect">
    <option value="'Cinzel', serif" selected>Cinzel</option>
    <option value="Arial, sans-serif">Arial</option>
    <option value="Times New Roman, serif">Times New Roman</option>
  </select>
  <input type="file" id="fontUpload"> (optional custom font TTF/OTF)<br><br>

  <button onclick="generateDeck()">Generate Deck</button>
  
  <div id="deck"></div>

  <script>
    const cardWidth = 400, cardHeight = 600;
    let suits = {}, bgImage = null, customFaces = {};
    let fontFamily = "'Cinzel', serif";

    function loadImage(file, callback){
      const reader = new FileReader();
      reader.onload = e => {
        const img = new Image();
        img.onload = () => callback(img);
        img.src = e.target.result;
      };
      reader.readAsDataURL(file);
    }

    // Suit uploads
    document.getElementById("spadeUpload").onchange = e => loadImage(e.target.files[0], img => suits["spade"]=img);
    document.getElementById("heartUpload").onchange = e => loadImage(e.target.files[0], img => suits["heart"]=img);
    document.getElementById("clubUpload").onchange = e => loadImage(e.target.files[0], img => suits["club"]=img);
    document.getElementById("diamondUpload").onchange = e => loadImage(e.target.files[0], img => suits["diamond"]=img);

    // Background upload
    document.getElementById("bgUpload").onchange = e => loadImage(e.target.files[0], img => bgImage = img);

    // Face/ace uploads
    document.getElementById("faceUpload").onchange = e => {
      Array.from(e.target.files).forEach(file=>{
        const key = file.name.split('.')[0]; // "spade_K"
        loadImage(file, img => customFaces[key] = img);
      });
    }

    // Font selection
    document.getElementById("fontSelect").onchange = e => fontFamily = e.target.value;
    document.getElementById("fontUpload").onchange = e => {
      const file = e.target.files[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = function(evt){
        const style = document.createElement('style');
        style.appendChild(document.createTextNode(`
          @font-face {
            font-family: 'CustomFont';
            src: url('${evt.target.result}');
          }
        `));
        document.head.appendChild(style);
        fontFamily = 'CustomFont';
      };
      reader.readAsDataURL(file);
    }

    // Draw corner ranks and suits
    function drawCorner(ctx, rank, suitImg, x, y, color, rotate=false){
      const fontSize = 60, suitSize = 36, spacing = 6;
      ctx.save();
      ctx.translate(x, y);
      if(rotate) ctx.rotate(Math.PI);

      ctx.fillStyle = color;
      ctx.font = `${fontSize}px ${fontFamily}`;

      ctx.textAlign = "center";
      let xOffset = 0;
    if (rank === 'Q' || rank === 'J' || rank === 'K') xOffset = -8; 
    ctx.fillText(rank, 0 + xOffset, 0);
      ctx.drawImage(suitImg, -suitSize/2, fontSize + spacing, suitSize, suitSize);
      ctx.restore();
    }

    // Pip layout alignment
    function getAlignedPositions(grid){
      const positions = [];
      const colX = [0.3,0.5,0.7];
      const sideCols = [0,2];
      let sideYs = [[],[]];

      sideCols.forEach((c,i)=>{
        const pipRows = [];
        for(let r=0;r<grid.length;r++) if(grid[r][c]===1) pipRows.push(r);
        const step = 1/(pipRows.length+1);
        pipRows.forEach((rowIndex,j)=>{
          const y = step*(j+1);
          sideYs[i].push(y);
          positions.push([colX[c],y]);
        });
      });

      const combinedSideYs = Array.from(new Set([...sideYs[0], ...sideYs[1]])).sort((a,b)=>a-b);
      const middleCol = 1;
      for(let r=0;r<grid.length;r++){
        if(grid[r][middleCol]===1){
          let above = combinedSideYs.filter(y=>y < (r+0.5)/grid.length);
          let below = combinedSideYs.filter(y=>y > (r+0.5)/grid.length);
          const yTop = above.length>0 ? Math.max(...above) : 0;
          const yBottom = below.length>0 ? Math.min(...below) : 1;
          const y = (yTop + yBottom)/2;
          positions.push([colX[middleCol], y]);
        }
      }
      return positions;
    }

    // Draw a full card
    function drawCard(ctx, rank, suitImg, color, suitName){
      if(bgImage) ctx.drawImage(bgImage,0,0,cardWidth,cardHeight);
      else { ctx.fillStyle="white"; ctx.fillRect(0,0,cardWidth,cardHeight); }
      ctx.strokeRect(0,0,cardWidth,cardHeight);

      const insetX = 50, insetY = 60;
      drawCorner(ctx, rank, suitImg, insetX, insetY, color, false);
      drawCorner(ctx, rank, suitImg, cardWidth - insetX, insetY, color, false);
      drawCorner(ctx, rank, suitImg, insetX, cardHeight - insetY, color, true);
      drawCorner(ctx, rank, suitImg, cardWidth - insetX, cardHeight - insetY, color, true);

      const key = `${suitName}_${rank}`;
      if(customFaces[key]){
        const img = customFaces[key];
        const scale = Math.min(cardWidth*0.6/img.width, cardHeight*0.6/img.height);
        const w = img.width * scale;
        const h = img.height * scale;
        ctx.drawImage(img,(cardWidth-w)/2,(cardHeight-h)/2,w,h);
        return;
      }

      const size = 60;
      let positions = [];
      switch(rank){
        case 2: positions=[[0.5,0.2],[0.5,0.8]]; break;
        case 3: positions=[[0.5,0.2],[0.5,0.5],[0.5,0.8]]; break;
        case 4: positions=[[0.3,0.25],[0.7,0.25],[0.3,0.75],[0.7,0.75]]; break;
        case 5: positions=[[0.3,0.25],[0.7,0.25],[0.5,0.5],[0.3,0.75],[0.7,0.75]]; break;
        case 6: positions=[[0.3,0.2],[0.7,0.2],[0.3,0.5],[0.7,0.5],[0.3,0.8],[0.7,0.8]]; break;
        case 7: positions = getAlignedPositions([[1,0,1],[0,1,0],[1,0,1],[0,0,0],[1,0,1]]); break;
        case 8: positions = getAlignedPositions([[1,0,1],[0,1,0],[1,0,1],[0,1,0],[1,0,1]]); break;
        case 9: positions = getAlignedPositions([[1,0,1],[1,0,1],[0,1,0],[1,0,1],[1,0,1]]); break;
        case 10: positions = getAlignedPositions([[1,0,1],[0,1,0],[1,0,1],[1,0,1],[0,1,0],[1,0,1]]); break;
      }

      positions.forEach(pos=>{
        const [x,y] = [pos[0]*cardWidth,pos[1]*cardHeight];
        const rotate = y>cardHeight/2;
        ctx.save();
        ctx.translate(x,y);
        if(rotate) ctx.rotate(Math.PI);
        ctx.drawImage(suitImg,-size/2,-size/2,size,size);
        ctx.restore();
      });
    }

    // Generate the full deck
    function generateDeck(){
      const deckDiv = document.getElementById("deck");
      deckDiv.innerHTML="";
      const ranks = [2,3,4,5,6,7,8,9,10,'J','Q','K','A'];
      const suitList = [
        {name:"spade", color:"black"},
        {name:"heart", color:"red"},
        {name:"club", color:"black"},
        {name:"diamond", color:"red"}
      ];

      suitList.forEach(suit=>{
        ranks.forEach(rank=>{
          if(!suits[suit.name]) return;
          const canvas = document.createElement("canvas");
          canvas.width = cardWidth;
          canvas.height = cardHeight;
          const ctx = canvas.getContext("2d");
          drawCard(ctx, rank, suits[suit.name], suit.color, suit.name);
          const img = new Image();
          img.src = canvas.toDataURL("image/png");
          img.className="card";
          deckDiv.appendChild(img);
        });
      });
    }
  </script>
</body>
</html>
